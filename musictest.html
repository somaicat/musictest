<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Musical Note Test - Ash C.</title>
    <script src="https://unpkg.com/tone"></script>
    <style>
    .manualButtons {
      color: red;
      float: right;
    }
    #displayResults {
      background-color: #00aaaa20;
    }
    #resDiv {
      display: none;
    }
    </style>
  </head>
  <body>
    <button onclick="playNotes()">Pick Notes</button>
    <button id="replayNotes" onclick="replayNotes()" disabled>Replay Notes</button>
    <button onclick="toggleDisplay()">Display Notes</button>

    <button class="manualButtons" onclick="playManualSame()">Play Same</button>
    <button class="manualButtons" onclick="playManualDifferent()">Play Different</button>
    <br><br>
    <button id="guessSame" onclick="guessSame()" disabled>Same</button>
    <button id="guessDifferent" onclick="guessDifferent()" disabled>Different</button>
    <br><br>
    <label id="guess-label">Enter choice</label>
    <br>
    <label id="resTotals"></label>
    <div id="resDiv">
       <br><hr><br>
        <label id="displayResults"></label>
    </div>
     <!--<br>
    <label id="resAttempts"></label>-->
    <script>
      const notes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
      const scale = ['3', '4', '5', '6'];
      var isSame
      var note1
      var note2
      var displayingResults = false
      var numCorrect = 0
      var numAttempts=0

      // DOMs
      var guessLabel = document.getElementById('guess-label')
      var displayResults = document.getElementById('displayResults')
      var guessButtonSame = document.getElementById('guessSame')
      var guessButtonDifferent = document.getElementById('guessDifferent')
      var resTotals = document.getElementById('resTotals')
      var resDiv = document.getElementById('resDiv')
      var replayButton = document.getElementById('replayNotes')

    //  var resAttempts = document.getElementById('resAttempts')
      function disableButtons() {
	  guessButtonSame.disabled = true
	  guessButtonDifferent.disabled = true

      }

      function enableButtons()
      {
	  guessButtonSame.disabled = false
	  guessButtonDifferent.disabled = false

      }
	
	function enterData(success)
	{
	  numAttempts++
	  if (success) {
	    numCorrect++
	  }
	  disableButtons()
	  resTotals.textContent = "Percent Correct: "+Math.floor(numCorrect/numAttempts*100.0)+"% ("+numCorrect+":"+(numAttempts-numCorrect)+")"
//	  resAttempts.innerHTML += ("Guessed " + (success ? "incorrectly" : "correctly") + "<br>")
	  }

	  function updateDisplayedNotes(disNotes) {
displayResults.textContent = "Note 1: " + disNotes[0] + " Note 2: "+disNotes[1] + " ["+(disNotes[0][0] === disNotes[1][0] ? "SAME" : "DIFFERENT")+"]";

	  }

function selectNotes(sameNote) {
        var selNote1 = notes[Math.floor(Math.random() * notes.length)];
	var selNote2
	var selScale1 = scale[Math.floor(Math.random() * scale.length)];
	var selScale2

	if (sameNote) {
	  selNote2 = selNote1
	} else { 
	  do {
	    selNote2 = notes[Math.floor(Math.random() * notes.length)];
	  }
	   while (selNote2 == selNote1);
	}

// Select any other scale for scale2
	  do {
	    selScale2 = scale[Math.floor(Math.random() * scale.length)];
	  }
	   while (selScale2 == selScale1);
	  
	  selNote1 += selScale1
	  selNote2 += selScale2
	  return [selNote1, selNote2]
  }

      function playNotes() {
	enableButtons()
	replayButton.disabled = false
	guessLabel.textContent = "Enter choice";
	if (Math.random() < 0.5) {
	  isSame = true
	} else { isSame = false }
	var notes = selectNotes(isSame)
	note1 = notes[0]
	note2 = notes[1]

	displayResults.textContent = "Note 1: " + note1 + " Note 2: "+note2 + " ["+(isSame ? "SAME" : "DIFFERENT")+"]";
        // Define a synth for playing the notes
        const synth = new Tone.Synth().toDestination();
	const now = Tone.now()

        // Play the notes
        synth.triggerAttackRelease(note1, "8n", now);
        synth.triggerAttackRelease(note2, "8n", now + 0.5);
      }

      function toggleDisplay() {
	displayingResults = !displayingResults;
	resDiv.style.display = displayingResults? 'block':'none';
      }

      function replayNotes() {
	const synth = new Tone.Synth().toDestination();
	const now = Tone.now()
	displayResults.textContent = "Note 1: " + note1 + " Note 2: "+note2 + " ["+(isSame ? "SAME" : "DIFFERENT")+"]";
        // Play the notes
        synth.triggerAttackRelease(note1, "8n", now);
        synth.triggerAttackRelease(note2, "8n", now + 0.5);

      }
      function playManualDifferent() {
	const notes = selectNotes(false)
	const synth = new Tone.Synth().toDestination();
	const now = Tone.now()
	updateDisplayedNotes(notes)
        // Play the notes
        synth.triggerAttackRelease(notes[0], "8n", now);
        synth.triggerAttackRelease(notes[1], "8n", now + 0.5);
      }
      function playManualSame() {
	const notes = selectNotes(true)
	const synth = new Tone.Synth().toDestination();
	const now = Tone.now()
        updateDisplayedNotes(notes)
	// Play the notes
        synth.triggerAttackRelease(notes[0], "8n", now);
        synth.triggerAttackRelease(notes[1], "8n", now + 0.5);

      }
      // Function to handle user guessing the notes were the same
      function guessSame() {
        if (isSame) {
          guessLabel.textContent = 'Correct';
        } else {
          guessLabel.textContent = 'Incorrect';
        }
	enterData(isSame)
      }

      // Function to handle user guessing the notes were different
      function guessDifferent() {
        if (!isSame) {
          guessLabel.textContent = 'Correct';
        } else {
          guessLabel.textContent = 'Incorrect';
        }
	enterData(!isSame)
      }
    </script>
  </body>
</html>

