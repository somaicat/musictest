<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Musical Note Test - Ash C.</title>
    <script src="https://unpkg.com/tone"></script>
    <style>
    #displayResults {
      background-color: #00aaaa20;
    }
    #resDiv {
      display: none;
    }
    </style>
  </head>
  <body>
    <button onclick="playNotes()">Pick Notes</button>
    <button onclick="replayNotes()">Replay Notes</button>
    <button onclick="toggleDisplay()">Display Notes</button>
    <br><br>
    <button id="guessSame" onclick="guessSame()" disabled>Same</button>
    <button id="guessDifferent" onclick="guessDifferent()" disabled>Different</button>
    <br><br>
    <label id="guess-label">Enter choice</label>
    <br>
    <label id="resTotals"></label>
    <div id="resDiv">
       <br><hr><br>
        <label id="displayResults"></label>
    </div>
     <!--<br>
    <label id="resAttempts"></label>-->
    <script>
      const notes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
      const scale = ['3', '4', '5', '6'];
      var isSame
      var note1
      var note2
      var displayingResults = false
      var numCorrect = 0
      var numAttempts=0

      // DOMs
      var guessLabel = document.getElementById('guess-label')
      var displayResults = document.getElementById('displayResults')
      var guessButtonSame = document.getElementById('guessSame')
      var guessButtonDifferent = document.getElementById('guessDifferent')
      var resTotals = document.getElementById('resTotals')
      var resDiv = document.getElementById('resDiv')

    //  var resAttempts = document.getElementById('resAttempts')
      function disableButtons() {
	  guessButtonSame.disabled = true
	  guessButtonDifferent.disabled = true

      }

      function enableButtons()
      {
	  guessButtonSame.disabled = false
	  guessButtonDifferent.disabled = false

      }
	
	function enterData(success)
	{
	  numAttempts++
	  if (success) {
	    numCorrect++
	  }
	  disableButtons()
	  resTotals.textContent = "Percent Correct: "+Math.floor(numCorrect/numAttempts*100.0)+"% ("+numCorrect+":"+(numAttempts-numCorrect)+")"
//	  resAttempts.innerHTML += ("Guessed " + (success ? "incorrectly" : "correctly") + "<br>")
	  }


      function playNotes() {
	enableButtons()
	guessLabel.textContent = "Enter choice";
        note1 = notes[Math.floor(Math.random() * notes.length)];
	if (Math.random() < 0.5) {
	  note2 = note1
	  isSame = true
	} else { 
	  do {
	    note2 = notes[Math.floor(Math.random() * notes.length)];
	  }
	   while (note2 == note1);
	  isSame = false
	}

	scale1 = scale[Math.floor(Math.random() * scale.length)];

	  do {
	    scale2 = scale[Math.floor(Math.random() * scale.length)];
	  }
	   while (scale2 == scale1);
	  
	  note1 += scale1
	  note2 += scale2

	displayResults.textContent = "Note 1: " + note1 + " Note 2: "+note2;

        // Define a synth for playing the notes
        const synth = new Tone.Synth().toDestination();
	const now = Tone.now()

        // Play the notes
        synth.triggerAttackRelease(note1, "8n", now);
        synth.triggerAttackRelease(note2, "8n", now + 0.5);
      }

      function toggleDisplay() {
	displayingResults = !displayingResults;
	resDiv.style.display = displayingResults? 'block':'none';
      }

      function replayNotes() {
	const synth = new Tone.Synth().toDestination();
	const now = Tone.now()

        // Play the notes
        synth.triggerAttackRelease(note1, "8n", now);
        synth.triggerAttackRelease(note2, "8n", now + 0.5);

      }

      // Function to handle user guessing the notes were the same
      function guessSame() {
        if (isSame) {
          guessLabel.textContent = 'Correct';
        } else {
          guessLabel.textContent = 'Incorrect';
        }
	enterData(isSame)
      }

      // Function to handle user guessing the notes were different
      function guessDifferent() {
        if (!isSame) {
          guessLabel.textContent = 'Correct';
        } else {
          guessLabel.textContent = 'Incorrect';
        }
	enterData(!isSame)
      }
    </script>
  </body>
</html>

